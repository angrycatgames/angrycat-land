var FlyCamera=pc.createScript("flyCamera");FlyCamera.attributes.add("speed",{type:"number",default:10}),FlyCamera.attributes.add("fastSpeed",{type:"number",default:20}),FlyCamera.attributes.add("mode",{type:"number",default:0,enum:[{Lock:0},{Drag:1}]}),FlyCamera.prototype.initialize=function(){var e=this.entity.getLocalEulerAngles();this.ex=e.x,this.ey=e.y,this.moved=!1,this.lmbDown=!1,this.app.mouse.disableContextMenu(),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this)},FlyCamera.prototype.update=function(e){this.entity.setLocalEulerAngles(this.ex,this.ey,0);var t=this.app,s=this.speed;t.keyboard.isPressed(pc.KEY_SHIFT)&&(s=this.fastSpeed),t.keyboard.isPressed(pc.KEY_UP)||t.keyboard.isPressed(pc.KEY_W)?this.entity.translateLocal(0,0,-s*e):(t.keyboard.isPressed(pc.KEY_DOWN)||t.keyboard.isPressed(pc.KEY_S))&&this.entity.translateLocal(0,0,s*e),t.keyboard.isPressed(pc.KEY_LEFT)||t.keyboard.isPressed(pc.KEY_A)?this.entity.translateLocal(-s*e,0,0):(t.keyboard.isPressed(pc.KEY_RIGHT)||t.keyboard.isPressed(pc.KEY_D))&&this.entity.translateLocal(s*e,0,0)},FlyCamera.prototype.onMouseMove=function(e){if(this.mode){if(!this.lmbDown)return}else if(!pc.Mouse.isPointerLocked())return;this.moved?(this.ex-=e.dy/5,this.ex=pc.math.clamp(this.ex,-90,90),this.ey-=e.dx/5):this.moved=!0},FlyCamera.prototype.onMouseDown=function(e){0===e.button&&(this.lmbDown=!0,this.mode||pc.Mouse.isPointerLocked()||this.app.mouse.enablePointerLock())},FlyCamera.prototype.onMouseUp=function(e){0===e.button&&(this.lmbDown=!1)};var Pickable=pc.createScript("pickable");Pickable.prototype.initialize=function(){this.pickedUp=!1,this.entity.collision.on("collisionstart",this.onCollisionStart,this),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this)},Pickable.prototype.onCollisionStart=function(t){if("Player"===t.other.name&&!this.pickedUp){this.pickedUp=!0;var i=t.other.findByName("Point");this.entity.reparent(i),this.entity.setPosition(i.getPosition())}},Pickable.prototype.onMouseDown=function(t){t.button===pc.MOUSEBUTTON_RIGHT&&(this.entity.reparent(this.app.root.findByName("Root")),this.pickedUp=!1)};var Toon=pc.createScript("toon");Toon.attributes.add("ramp",{type:"asset",assetType:"texture"}),Toon.attributes.add("edgeSize",{type:"number",default:.005}),Toon.attributes.add("edgeColor",{type:"rgba",default:[0,0,0,1]}),Toon.prototype.initialize=function(){for(var e=this.app.assets.find("transformToonEdgeVS").resource,t=this.app.assets.find("transformToonEdgeSkinnedVS").resource,s=this.app.assets.find("lightDiffuseToonPS").resource,a=this.app.assets.find("edgeToonPS").resource,o=this.ramp.resource,n=this.entity.model.model.meshInstances,r=[],d=0;d<n.length;d++){var i=n[d],p=i.material;p.chunks.lightDiffuseLambertPS=s,p.setParameter("texture_ramp",o),p.update();var c=p.clone();c.chunks.transformVS=e,c.chunks.transformSkinnedVS=t,c.customFragmentShader=a,c.cull=pc.CULLFACE_FRONT,c.update();var h=new pc.MeshInstance(i.node,i.mesh,c);h.castShadow=!1,h.receiveShadow=!1,h.skinInstance=i.skinInstance,h.setParameter("edgeSize",this.edgeSize),h.setParameter("edgeColor",this.edgeColor.data),h.updateKey(),r.push(h)}this.app.scene.removeModel(this.entity.model.model),this.entity.model.model.meshInstances=n.concat(r),this.app.scene.addModel(this.entity.model.model)},Toon.prototype.update=function(e){};var FirstPersonMovement=pc.createScript("firstPersonMovement");FirstPersonMovement.attributes.add("camera",{type:"entity",description:"Optional, assign a camera entity, otherwise one is created"}),FirstPersonMovement.attributes.add("power",{type:"number",default:2500,description:"Adjusts the speed of player movement"}),FirstPersonMovement.attributes.add("lookSpeed",{type:"number",default:.25,description:"Adjusts the sensitivity of looking"}),FirstPersonMovement.prototype.initialize=function(){this.force=new pc.Vec3,this.eulers=new pc.Vec3;var e=this.app;e.mouse.on("mousemove",this._onMouseMove,this),e.mouse.on("mousedown",(function(){e.mouse.enablePointerLock()}),this),this.entity.collision||console.error("First Person Movement script needs to have a 'collision' component"),this.entity.rigidbody&&this.entity.rigidbody.type===pc.BODYTYPE_DYNAMIC||console.error("First Person Movement script needs to have a DYNAMIC 'rigidbody' component")},FirstPersonMovement.prototype.update=function(e){this.camera||this._createCamera();var t=this.force,s=this.app,o=this.camera.forward,i=this.camera.right,r=0,n=0;(s.keyboard.isPressed(pc.KEY_A)||s.keyboard.isPressed(pc.KEY_Q))&&(r-=i.x,n-=i.z),s.keyboard.isPressed(pc.KEY_D)&&(r+=i.x,n+=i.z),s.keyboard.isPressed(pc.KEY_W)&&(r+=o.x,n+=o.z),s.keyboard.isPressed(pc.KEY_S)&&(r-=o.x,n-=o.z),0!==r&&0!==n&&(t.set(r,0,n).normalize().scale(this.power),this.entity.rigidbody.applyForce(t)),this.camera.setLocalEulerAngles(this.eulers.y,this.eulers.x,0)},FirstPersonMovement.prototype._onMouseMove=function(e){(pc.Mouse.isPointerLocked()||e.buttons[0])&&(this.eulers.x-=this.lookSpeed*e.dx,this.eulers.y-=this.lookSpeed*e.dy)},FirstPersonMovement.prototype._createCamera=function(){this.camera=new pc.Entity,this.camera.setName("First Person Camera"),this.camera.addComponent("camera"),this.entity.addChild(this.camera),this.camera.translateLocal(0,.5,0)};var Cat=pc.createScript("cat");Cat.prototype.initialize=function(){this.entity.collision.on("trigger",this.onCollision,this)},Cat.prototype.onCollision=function(t){console.log("aaaaaaa")};var Jump=pc.createScript("Jump");Jump.prototype.initialize=function(){this.canJump=!1,this.entity.collision.on("collisionstart",this.onCollisionStart,this),this.entity.collision.on("collisionend",this.onCollisionEnd,this),this.canJump=!0},Jump.prototype.onCollisionStart=function(i){i.other.rigidbody&&(this.canJump=!0)},Jump.prototype.onCollisionEnd=function(){this.canJump=!1},Jump.prototype.update=function(i){this.app.keyboard.isPressed(32)&&!0===this.canJump&&this.entity.rigidbody.applyImpulse(0,350,0)};var Bullet=pc.createScript("bullet");Bullet.prototype.initialize=function(){},Bullet.prototype.update=function(t){},Bullet.prototype.deleteBullet=function(){var t=this.app.root.findByName("Player"),e=this.entity.getPosition().clone();e.sub(t.getPosition()),e.length()>100&&this.entity.destroy()},Bullet.prototype.notifyPlayer=function(){PhotonController.photon.raiseEvent(4,this.pickedEntity.entity.name)};var Manager=pc.createScript("manager");Manager.attributes.add("template",{title:"Template",type:"entity"}),Manager.attributes.add("numClones",{title:"Num Clones",type:"number",default:50}),Manager.attributes.add("spread",{title:"Spread",type:"number",default:10}),Manager.prototype.initialize=function(){this.entities=[];for(var t=0;t<this.numClones;t++){var e=this.template.clone();e.enabled=!0,this.app.root.addChild(e),this.entities.push(e),this.reset(e)}},Manager.prototype.update=function(t){this.entities.forEach((function(t){t.getPosition().y<-10&&this.reset(t)}),this)},Manager.prototype.reset=function(t){var e=this.entity.getPosition();t.rigidbody.linearVelocity=pc.Vec3.ZERO,t.rigidbody.angularVelocity=pc.Vec3.ZERO,t.rigidbody.teleport(e.x+(Math.random()-.5)*this.spread,e.y,e.z+(Math.random()-.5)*this.spread)};var VideoTexture=pc.createScript("videoTexture");VideoTexture.attributes.add("videoAsset",{title:"Video Asset",description:"MP4 video asset to play back on this video texture.",type:"asset"}),VideoTexture.attributes.add("videoUrl",{title:"Video Url",description:"URL to use if there is video asset selected",type:"string"}),VideoTexture.attributes.add("playEvent",{title:"Play Event",description:"Event that is fired as soon as the video texture is ready to play.",type:"string",default:""}),VideoTexture.prototype.initialize=function(){var e=this.app,t=document.createElement("video");t.loop=!0,t.muted=!0,t.playsInline=!0,t.crossOrigin="anonymous",t.autoplay=!0;var i=t.style;i.width="1px",i.height="1px",i.position="absolute",i.opacity="0",i.zIndex="-1000",i.pointerEvents="none",document.body.appendChild(t),this.videoTexture=new pc.Texture(e.graphicsDevice,{format:pc.PIXELFORMAT_R8_G8_B8,minFilter:pc.FILTER_LINEAR_MIPMAP_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,mipmaps:!0}),this.videoTexture.setSource(t),t.addEventListener("canplaythrough",function(i){e.fire(this.playEvent,this.videoTexture),t.play()}.bind(this)),t.src=this.videoAsset?this.videoAsset.getFileUrl():this.videoUrl,document.body.appendChild(t),t.load(),this.on("destroy",(function(){this.videoTexture.destroy(),t.remove()}),this)},VideoTexture.prototype.update=function(e){this.videoTexture.upload()};var TvScreen=pc.createScript("tvScreen");TvScreen.attributes.add("screenMaterial",{title:"Screen Material",description:"The screen material of the TV that displays the video texture.",type:"asset",assetType:"material"}),TvScreen.attributes.add("playEvent",{title:"Play Event",description:"Set the TV screen material emissive map on this event.",type:"string",default:""}),TvScreen.prototype.initialize=function(){this.app.on(this.playEvent,(function(e){var t=this.screenMaterial.resource;t.emissiveMap=e,t.update()}),this)};